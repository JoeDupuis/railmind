<div id="auto_push_form" class="auto-push-form" data-controller="auto-push" 
     data-auto-push-task-id-value="<%= task.id %>"
     data-auto-push-branches-url-value="<%= branches_task_path(task) %>"
     data-auto-push-enabled-value="<%= task.auto_push_enabled %>"
     data-auto-push-current-branch-value="<%= task.auto_push_branch %>">
  <%= form_with model: task, url: update_auto_push_task_path(task), method: :patch, data: { turbo_frame: "_top" } do |form| %>
    <div class="form-group">
      <%= form.check_box :auto_push_enabled, class: "form-check-input", data: { action: "change->auto-push#toggleAutoPush" } %>
      <%= form.label :auto_push_enabled, "Enable Auto Push", class: "form-check-label" %>
    </div>
    
    <div class="form-group" data-auto-push-target="branchSelection" style="<%= task.auto_push_enabled? ? '' : 'display: none;' %>">
      <%= form.label :auto_push_branch, "Select Branch to Push" %>
      <%= form.select :auto_push_branch, 
          options_for_select([task.auto_push_branch].compact, task.auto_push_branch),
          { include_blank: "Select a branch..." },
          { class: "form-control", data: { auto_push_target: "branchSelect" } } %>
      <button type="button" class="action-button -primary" data-action="click->auto-push#fetchBranches">
        Refresh Branches
      </button>
    </div>
    
    <div class="form-actions">
      <%= form.submit "Save Auto Push Settings", class: "action-button -primary" %>
    </div>
  <% end %>
</div>