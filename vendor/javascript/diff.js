// diff@7.0.0 downloaded from https://ga.jspm.io/npm:diff@7.0.0/lib/index.mjs

function Diff(){}Diff.prototype={diff:function diff(e,n){var r;var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i=t.callback;if(typeof t==="function"){i=t;t={}}var a=this;function done(e){e=a.postProcess(e,t);if(i){setTimeout((function(){i(e)}),0);return true}return e}e=this.castInput(e,t);n=this.castInput(n,t);e=this.removeEmpty(this.tokenize(e,t));n=this.removeEmpty(this.tokenize(n,t));var o=n.length,l=e.length;var s=1;var u=o+l;t.maxEditLength!=null&&(u=Math.min(u,t.maxEditLength));var f=(r=t.timeout)!==null&&r!==void 0?r:Infinity;var c=Date.now()+f;var d=[{oldPos:-1,lastComponent:void 0}];var h=this.extractCommon(d[0],n,e,0,t);if(d[0].oldPos+1>=l&&h+1>=o)return done(buildValues(a,d[0].lastComponent,n,e,a.useLongestToken));var p=-Infinity,v=Infinity;function execEditLength(){for(var r=Math.max(p,-s);r<=Math.min(v,s);r+=2){var i=void 0;var u=d[r-1],f=d[r+1];u&&(d[r-1]=void 0);var c=false;if(f){var m=f.oldPos-r;c=f&&0<=m&&m<o}var g=u&&u.oldPos+1<l;if(c||g){i=!g||c&&u.oldPos<f.oldPos?a.addToPath(f,true,false,0,t):a.addToPath(u,false,true,1,t);h=a.extractCommon(i,n,e,r,t);if(i.oldPos+1>=l&&h+1>=o)return done(buildValues(a,i.lastComponent,n,e,a.useLongestToken));d[r]=i;i.oldPos+1>=l&&(v=Math.min(v,r-1));h+1>=o&&(p=Math.max(p,r+1))}else d[r]=void 0}s++}if(i)(function exec(){setTimeout((function(){if(s>u||Date.now()>c)return i();execEditLength()||exec()}),0)})();else while(s<=u&&Date.now()<=c){var m=execEditLength();if(m)return m}},addToPath:function addToPath(e,n,r,t,i){var a=e.lastComponent;return a&&!i.oneChangePerToken&&a.added===n&&a.removed===r?{oldPos:e.oldPos+t,lastComponent:{count:a.count+1,added:n,removed:r,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+t,lastComponent:{count:1,added:n,removed:r,previousComponent:a}}},extractCommon:function extractCommon(e,n,r,t,i){var a=n.length,o=r.length,l=e.oldPos,s=l-t,u=0;while(s+1<a&&l+1<o&&this.equals(r[l+1],n[s+1],i)){s++;l++;u++;i.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:false,removed:false})}u&&!i.oneChangePerToken&&(e.lastComponent={count:u,previousComponent:e.lastComponent,added:false,removed:false});e.oldPos=l;return s},equals:function equals(e,n,r){return r.comparator?r.comparator(e,n):e===n||r.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function removeEmpty(e){var n=[];for(var r=0;r<e.length;r++)e[r]&&n.push(e[r]);return n},castInput:function castInput(e){return e},tokenize:function tokenize(e){return Array.from(e)},join:function join(e){return e.join("")},postProcess:function postProcess(e){return e}};function buildValues(e,n,r,t,i){var a=[];var o;while(n){a.push(n);o=n.previousComponent;delete n.previousComponent;n=o}a.reverse();var l=0,s=a.length,u=0,f=0;for(;l<s;l++){var c=a[l];if(c.removed){c.value=e.join(t.slice(f,f+c.count));f+=c.count}else{if(!c.added&&i){var d=r.slice(u,u+c.count);d=d.map((function(e,n){var r=t[f+n];return r.length>e.length?r:e}));c.value=e.join(d)}else c.value=e.join(r.slice(u,u+c.count));u+=c.count;c.added||(f+=c.count)}}return a}var e=new Diff;function diffChars(n,r,t){return e.diff(n,r,t)}function longestCommonPrefix(e,n){var r;for(r=0;r<e.length&&r<n.length;r++)if(e[r]!=n[r])return e.slice(0,r);return e.slice(0,r)}function longestCommonSuffix(e,n){var r;if(!e||!n||e[e.length-1]!=n[n.length-1])return"";for(r=0;r<e.length&&r<n.length;r++)if(e[e.length-(r+1)]!=n[n.length-(r+1)])return e.slice(-r);return e.slice(-r)}function replacePrefix(e,n,r){if(e.slice(0,n.length)!=n)throw Error("string ".concat(JSON.stringify(e)," doesn't start with prefix ").concat(JSON.stringify(n),"; this is a bug"));return r+e.slice(n.length)}function replaceSuffix(e,n,r){if(!n)return e+r;if(e.slice(-n.length)!=n)throw Error("string ".concat(JSON.stringify(e)," doesn't end with suffix ").concat(JSON.stringify(n),"; this is a bug"));return e.slice(0,-n.length)+r}function removePrefix(e,n){return replacePrefix(e,n,"")}function removeSuffix(e,n){return replaceSuffix(e,n,"")}function maximumOverlap(e,n){return n.slice(0,overlapCount(e,n))}function overlapCount(e,n){var r=0;e.length>n.length&&(r=e.length-n.length);var t=n.length;e.length<n.length&&(t=e.length);var i=Array(t);var a=0;i[0]=0;for(var o=1;o<t;o++){n[o]==n[a]?i[o]=i[a]:i[o]=a;while(a>0&&n[o]!=n[a])a=i[a];n[o]==n[a]&&a++}a=0;for(var l=r;l<e.length;l++){while(a>0&&e[l]!=n[a])a=i[a];e[l]==n[a]&&a++}return a}function hasOnlyWinLineEndings(e){return e.includes("\r\n")&&!e.startsWith("\n")&&!e.match(/[^\r]\n/)}function hasOnlyUnixLineEndings(e){return!e.includes("\r\n")&&e.includes("\n")}var n="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}";var r=new RegExp("[".concat(n,"]+|\\s+|[^").concat(n,"]"),"ug");var t=new Diff;t.equals=function(e,n,r){if(r.ignoreCase){e=e.toLowerCase();n=n.toLowerCase()}return e.trim()===n.trim()};t.tokenize=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;if(n.intlSegmenter){if(n.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');t=Array.from(n.intlSegmenter.segment(e),(function(e){return e.segment}))}else t=e.match(r)||[];var i=[];var a=null;t.forEach((function(e){/\s/.test(e)?a==null?i.push(e):i.push(i.pop()+e):/\s/.test(a)?i[i.length-1]==a?i.push(i.pop()+e):i.push(a+e):i.push(e);a=e}));return i};t.join=function(e){return e.map((function(e,n){return n==0?e:e.replace(/^\s+/,"")})).join("")};t.postProcess=function(e,n){if(!e||n.oneChangePerToken)return e;var r=null;var t=null;var i=null;e.forEach((function(e){if(e.added)t=e;else if(e.removed)i=e;else{(t||i)&&dedupeWhitespaceInChangeObjects(r,i,t,e);r=e;t=null;i=null}}));(t||i)&&dedupeWhitespaceInChangeObjects(r,i,t,null);return e};function diffWords(e,n,r){return(r===null||r===void 0?void 0:r.ignoreWhitespace)==null||r.ignoreWhitespace?t.diff(e,n,r):diffWordsWithSpace(e,n,r)}function dedupeWhitespaceInChangeObjects(e,n,r,t){if(n&&r){var i=n.value.match(/^\s*/)[0];var a=n.value.match(/\s*$/)[0];var o=r.value.match(/^\s*/)[0];var l=r.value.match(/\s*$/)[0];if(e){var s=longestCommonPrefix(i,o);e.value=replaceSuffix(e.value,o,s);n.value=removePrefix(n.value,s);r.value=removePrefix(r.value,s)}if(t){var u=longestCommonSuffix(a,l);t.value=replacePrefix(t.value,l,u);n.value=removeSuffix(n.value,u);r.value=removeSuffix(r.value,u)}}else if(r){e&&(r.value=r.value.replace(/^\s*/,""));t&&(t.value=t.value.replace(/^\s*/,""))}else if(e&&t){var f=t.value.match(/^\s*/)[0],c=n.value.match(/^\s*/)[0],d=n.value.match(/\s*$/)[0];var h=longestCommonPrefix(f,c);n.value=removePrefix(n.value,h);var p=longestCommonSuffix(removePrefix(f,h),d);n.value=removeSuffix(n.value,p);t.value=replacePrefix(t.value,f,p);e.value=replaceSuffix(e.value,f,f.slice(0,f.length-p.length))}else if(t){var v=t.value.match(/^\s*/)[0];var m=n.value.match(/\s*$/)[0];var g=maximumOverlap(m,v);n.value=removeSuffix(n.value,g)}else if(e){var y=e.value.match(/\s*$/)[0];var w=n.value.match(/^\s*/)[0];var b=maximumOverlap(y,w);n.value=removePrefix(n.value,b)}}var i=new Diff;i.tokenize=function(e){var r=new RegExp("(\\r?\\n)|[".concat(n,"]+|[^\\S\\n\\r]+|[^").concat(n,"]"),"ug");return e.match(r)||[]};function diffWordsWithSpace(e,n,r){return i.diff(e,n,r)}function generateOptions(e,n){if(typeof e==="function")n.callback=e;else if(e)for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}var a=new Diff;a.tokenize=function(e,n){n.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));var r=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var i=0;i<t.length;i++){var a=t[i];i%2&&!n.newlineIsToken?r[r.length-1]+=a:r.push(a)}return r};a.equals=function(e,n,r){if(r.ignoreWhitespace){r.newlineIsToken&&e.includes("\n")||(e=e.trim());r.newlineIsToken&&n.includes("\n")||(n=n.trim())}else if(r.ignoreNewlineAtEof&&!r.newlineIsToken){e.endsWith("\n")&&(e=e.slice(0,-1));n.endsWith("\n")&&(n=n.slice(0,-1))}return Diff.prototype.equals.call(this,e,n,r)};function diffLines(e,n,r){return a.diff(e,n,r)}function diffTrimmedLines(e,n,r){var t=generateOptions(r,{ignoreWhitespace:true});return a.diff(e,n,t)}var o=new Diff;o.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};function diffSentences(e,n,r){return o.diff(e,n,r)}var l=new Diff;l.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};function diffCss(e,n,r){return l.diff(e,n,r)}function ownKeys(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function _objectSpread2(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ownKeys(Object(r),!0).forEach((function(n){_defineProperty(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function _toPrimitive(e,n){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,n||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function _toPropertyKey(e){var n=_toPrimitive(e,"string");return"symbol"==typeof n?n:n+""}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,n,r){n=_toPropertyKey(n);n in e?Object.defineProperty(e,n,{value:r,enumerable:true,configurable:true,writable:true}):e[n]=r;return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _unsupportedIterableToArray(e,n){if(e){if(typeof e==="string")return _arrayLikeToArray(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);r==="Object"&&e.constructor&&(r=e.constructor.name);return r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=new Diff;s.useLongestToken=true;s.tokenize=a.tokenize;s.castInput=function(e,n){var r=n.undefinedReplacement,t=n.stringifyReplacer,i=t===void 0?function(e,n){return typeof n==="undefined"?r:n}:t;return typeof e==="string"?e:JSON.stringify(canonicalize(e,null,null,i),i,"  ")};s.equals=function(e,n,r){return Diff.prototype.equals.call(s,e.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"),r)};function diffJson(e,n,r){return s.diff(e,n,r)}function canonicalize(e,n,r,t,i){n=n||[];r=r||[];t&&(e=t(i,e));var a;for(a=0;a<n.length;a+=1)if(n[a]===e)return r[a];var o;if("[object Array]"===Object.prototype.toString.call(e)){n.push(e);o=new Array(e.length);r.push(o);for(a=0;a<e.length;a+=1)o[a]=canonicalize(e[a],n,r,t,i);n.pop();r.pop();return o}e&&e.toJSON&&(e=e.toJSON());if(_typeof(e)==="object"&&e!==null){n.push(e);o={};r.push(o);var l,s=[];for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&s.push(l);s.sort();for(a=0;a<s.length;a+=1){l=s[a];o[l]=canonicalize(e[l],n,r,t,l)}n.pop();r.pop()}else o=e;return o}var u=new Diff;u.tokenize=function(e){return e.slice()};u.join=u.removeEmpty=function(e){return e};function diffArrays(e,n,r){return u.diff(e,n,r)}function unixToWin(e){return Array.isArray(e)?e.map(unixToWin):_objectSpread2(_objectSpread2({},e),{},{hunks:e.hunks.map((function(e){return _objectSpread2(_objectSpread2({},e),{},{lines:e.lines.map((function(n,r){var t;return n.startsWith("\\")||n.endsWith("\r")||(t=e.lines[r+1])!==null&&t!==void 0&&t.startsWith("\\")?n:n+"\r"}))})}))})}function winToUnix(e){return Array.isArray(e)?e.map(winToUnix):_objectSpread2(_objectSpread2({},e),{},{hunks:e.hunks.map((function(e){return _objectSpread2(_objectSpread2({},e),{},{lines:e.lines.map((function(e){return e.endsWith("\r")?e.substring(0,e.length-1):e}))})}))})}function isUnix(e){Array.isArray(e)||(e=[e]);return!e.some((function(e){return e.hunks.some((function(e){return e.lines.some((function(e){return!e.startsWith("\\")&&e.endsWith("\r")}))}))}))}function isWin(e){Array.isArray(e)||(e=[e]);return e.some((function(e){return e.hunks.some((function(e){return e.lines.some((function(e){return e.endsWith("\r")}))}))}))&&e.every((function(e){return e.hunks.every((function(e){return e.lines.every((function(n,r){var t;return n.startsWith("\\")||n.endsWith("\r")||((t=e.lines[r+1])===null||t===void 0?void 0:t.startsWith("\\"))}))}))}))}function parsePatch(e){var n=e.split(/\n/),r=[],t=0;function parseIndex(){var e={};r.push(e);while(t<n.length){var i=n[t];if(/^(\-\-\-|\+\+\+|@@)\s/.test(i))break;var a=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(i);a&&(e.index=a[1]);t++}parseFileHeader(e);parseFileHeader(e);e.hunks=[];while(t<n.length){var o=n[t];if(/^(Index:\s|diff\s|\-\-\-\s|\+\+\+\s|===================================================================)/.test(o))break;if(/^@@/.test(o))e.hunks.push(parseHunk());else{if(o)throw new Error("Unknown line "+(t+1)+" "+JSON.stringify(o));t++}}}function parseFileHeader(e){var r=/^(---|\+\+\+)\s+(.*)\r?$/.exec(n[t]);if(r){var i=r[1]==="---"?"old":"new";var a=r[2].split("\t",2);var o=a[0].replace(/\\\\/g,"\\");/^".*"$/.test(o)&&(o=o.substr(1,o.length-2));e[i+"FileName"]=o;e[i+"Header"]=(a[1]||"").trim();t++}}function parseHunk(){var e=t,r=n[t++],i=r.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/);var a={oldStart:+i[1],oldLines:typeof i[2]==="undefined"?1:+i[2],newStart:+i[3],newLines:typeof i[4]==="undefined"?1:+i[4],lines:[]};a.oldLines===0&&(a.oldStart+=1);a.newLines===0&&(a.newStart+=1);var o=0,l=0;for(;t<n.length&&(l<a.oldLines||o<a.newLines||(s=n[t])!==null&&s!==void 0&&s.startsWith("\\"));t++){var s;var u=n[t].length==0&&t!=n.length-1?" ":n[t][0];if(u!=="+"&&u!=="-"&&u!==" "&&u!=="\\")throw new Error("Hunk at line ".concat(e+1," contained invalid line ").concat(n[t]));a.lines.push(n[t]);if(u==="+")o++;else if(u==="-")l++;else if(u===" "){o++;l++}}o||a.newLines!==1||(a.newLines=0);l||a.oldLines!==1||(a.oldLines=0);if(o!==a.newLines)throw new Error("Added line count did not match for hunk at line "+(e+1));if(l!==a.oldLines)throw new Error("Removed line count did not match for hunk at line "+(e+1));return a}while(t<n.length)parseIndex();return r}function distanceIterator(e,n,r){var t=true,i=false,a=false,o=1;return function iterator(){if(t&&!a){i?o++:t=false;if(e+o<=r)return e+o;a=true}if(!i){a||(t=true);if(n<=e-o)return e-o++;i=true;return iterator()}}}function applyPatch(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};typeof n==="string"&&(n=parsePatch(n));if(Array.isArray(n)){if(n.length>1)throw new Error("applyPatch only works with a single input.");n=n[0]}(r.autoConvertLineEndings||r.autoConvertLineEndings==null)&&(hasOnlyWinLineEndings(e)&&isUnix(n)?n=unixToWin(n):hasOnlyUnixLineEndings(e)&&isWin(n)&&(n=winToUnix(n)));var t=e.split("\n"),i=n.hunks,a=r.compareLine||function(e,n,r,t){return n===t},o=r.fuzzFactor||0,l=0;if(o<0||!Number.isInteger(o))throw new Error("fuzzFactor must be a non-negative integer");if(!i.length)return e;var s="",u=false,f=false;for(var c=0;c<i[i.length-1].lines.length;c++){var d=i[i.length-1].lines[c];d[0]=="\\"&&(s[0]=="+"?u=true:s[0]=="-"&&(f=true));s=d}if(u){if(f){if(!o&&t[t.length-1]=="")return false}else if(t[t.length-1]=="")t.pop();else if(!o)return false}else if(f)if(t[t.length-1]!="")t.push("");else if(!o)return false;function applyHunk(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;var o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;var u=0;var f=false;for(;i<e.length;i++){var c=e[i],d=c.length>0?c[0]:" ",h=c.length>0?c.substr(1):c;if(d==="-"){if(!a(n+1,t[n],d,h)){if(!r||t[n]==null)return null;l[s]=t[n];return applyHunk(e,n+1,r-1,i,false,l,s+1)}n++;u=0}if(d==="+"){if(!o)return null;l[s]=h;s++;u=0;f=true}if(d===" "){u++;l[s]=t[n];if(!a(n+1,t[n],d,h))return f||!r?null:t[n]&&(applyHunk(e,n+1,r-1,i+1,false,l,s+1)||applyHunk(e,n+1,r-1,i,false,l,s+1))||applyHunk(e,n,r-1,i+1,false,l,s);s++;o=true;f=false;n++}}s-=u;n-=u;l.length=s;return{patchedLines:l,oldLineLastI:n-1}}var h=[];var p=0;for(var v=0;v<i.length;v++){var m=i[v];var g=void 0;var y=t.length-m.oldLines+o;var w=void 0;for(var b=0;b<=o;b++){w=m.oldStart+p-1;var L=distanceIterator(w,l,y);for(;w!==void 0;w=L()){g=applyHunk(m.lines,w,b);if(g)break}if(g)break}if(!g)return false;for(var x=l;x<w;x++)h.push(t[x]);for(var S=0;S<g.patchedLines.length;S++){var P=g.patchedLines[S];h.push(P)}l=g.oldLineLastI+1;p=w+1-m.oldStart}for(var k=l;k<t.length;k++)h.push(t[k]);return h.join("\n")}function applyPatches(e,n){typeof e==="string"&&(e=parsePatch(e));var r=0;function processIndex(){var t=e[r++];if(!t)return n.complete();n.loadFile(t,(function(e,r){if(e)return n.complete(e);var i=applyPatch(r,t,n);n.patched(t,i,(function(e){if(e)return n.complete(e);processIndex()}))}))}processIndex()}function structuredPatch(e,n,r,t,i,a,o){o||(o={});typeof o==="function"&&(o={callback:o});typeof o.context==="undefined"&&(o.context=4);if(o.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(!o.callback)return diffLinesResultToPatch(diffLines(r,t,o));var l=o,s=l.callback;diffLines(r,t,_objectSpread2(_objectSpread2({},o),{},{callback:function callback(e){var n=diffLinesResultToPatch(e);s(n)}}));function diffLinesResultToPatch(r){if(r){r.push({value:"",lines:[]});var t=[];var l=0,s=0,u=[],f=1,c=1;var d=function _loop(){var e=r[h],n=e.lines||splitLines(e.value);e.lines=n;if(e.added||e.removed){var i;if(!l){var a=r[h-1];l=f;s=c;if(a){u=o.context>0?contextLines(a.lines.slice(-o.context)):[];l-=u.length;s-=u.length}}(i=u).push.apply(i,_toConsumableArray(n.map((function(n){return(e.added?"+":"-")+n}))));e.added?c+=n.length:f+=n.length}else{if(l)if(n.length<=o.context*2&&h<r.length-2){var d;(d=u).push.apply(d,_toConsumableArray(contextLines(n)))}else{var p;var v=Math.min(n.length,o.context);(p=u).push.apply(p,_toConsumableArray(contextLines(n.slice(0,v))));var m={oldStart:l,oldLines:f-l+v,newStart:s,newLines:c-s+v,lines:u};t.push(m);l=0;s=0;u=[]}f+=n.length;c+=n.length}};for(var h=0;h<r.length;h++)d();for(var p=0,v=t;p<v.length;p++){var m=v[p];for(var g=0;g<m.lines.length;g++)if(m.lines[g].endsWith("\n"))m.lines[g]=m.lines[g].slice(0,-1);else{m.lines.splice(g+1,0,"\\ No newline at end of file");g++}}return{oldFileName:e,newFileName:n,oldHeader:i,newHeader:a,hunks:t}}function contextLines(e){return e.map((function(e){return" "+e}))}}}function formatPatch(e){if(Array.isArray(e))return e.map(formatPatch).join("\n");var n=[];e.oldFileName==e.newFileName&&n.push("Index: "+e.oldFileName);n.push("===================================================================");n.push("--- "+e.oldFileName+(typeof e.oldHeader==="undefined"?"":"\t"+e.oldHeader));n.push("+++ "+e.newFileName+(typeof e.newHeader==="undefined"?"":"\t"+e.newHeader));for(var r=0;r<e.hunks.length;r++){var t=e.hunks[r];t.oldLines===0&&(t.oldStart-=1);t.newLines===0&&(t.newStart-=1);n.push("@@ -"+t.oldStart+","+t.oldLines+" +"+t.newStart+","+t.newLines+" @@");n.push.apply(n,t.lines)}return n.join("\n")+"\n"}function createTwoFilesPatch(e,n,r,t,i,a,o){var l;typeof o==="function"&&(o={callback:o});if((l=o)===null||l===void 0||!l.callback){var s=structuredPatch(e,n,r,t,i,a,o);if(!s)return;return formatPatch(s)}var u=o,f=u.callback;structuredPatch(e,n,r,t,i,a,_objectSpread2(_objectSpread2({},o),{},{callback:function callback(e){e?f(formatPatch(e)):f()}}))}function createPatch(e,n,r,t,i,a){return createTwoFilesPatch(e,e,n,r,t,i,a)}function splitLines(e){var n=e.endsWith("\n");var r=e.split("\n").map((function(e){return e+"\n"}));n?r.pop():r.push(r.pop().slice(0,-1));return r}function arrayEqual(e,n){return e.length===n.length&&arrayStartsWith(e,n)}function arrayStartsWith(e,n){if(n.length>e.length)return false;for(var r=0;r<n.length;r++)if(n[r]!==e[r])return false;return true}function calcLineCount(e){var n=calcOldNewLineCount(e.lines),r=n.oldLines,t=n.newLines;r!==void 0?e.oldLines=r:delete e.oldLines;t!==void 0?e.newLines=t:delete e.newLines}function merge(e,n,r){e=loadPatch(e,r);n=loadPatch(n,r);var t={};(e.index||n.index)&&(t.index=e.index||n.index);if(e.newFileName||n.newFileName)if(fileNameChanged(e))if(fileNameChanged(n)){t.oldFileName=selectField(t,e.oldFileName,n.oldFileName);t.newFileName=selectField(t,e.newFileName,n.newFileName);t.oldHeader=selectField(t,e.oldHeader,n.oldHeader);t.newHeader=selectField(t,e.newHeader,n.newHeader)}else{t.oldFileName=e.oldFileName;t.newFileName=e.newFileName;t.oldHeader=e.oldHeader;t.newHeader=e.newHeader}else{t.oldFileName=n.oldFileName||e.oldFileName;t.newFileName=n.newFileName||e.newFileName;t.oldHeader=n.oldHeader||e.oldHeader;t.newHeader=n.newHeader||e.newHeader}t.hunks=[];var i=0,a=0,o=0,l=0;while(i<e.hunks.length||a<n.hunks.length){var s=e.hunks[i]||{oldStart:Infinity},u=n.hunks[a]||{oldStart:Infinity};if(hunkBefore(s,u)){t.hunks.push(cloneHunk(s,o));i++;l+=s.newLines-s.oldLines}else if(hunkBefore(u,s)){t.hunks.push(cloneHunk(u,l));a++;o+=u.newLines-u.oldLines}else{var f={oldStart:Math.min(s.oldStart,u.oldStart),oldLines:0,newStart:Math.min(s.newStart+o,u.oldStart+l),newLines:0,lines:[]};mergeLines(f,s.oldStart,s.lines,u.oldStart,u.lines);a++;i++;t.hunks.push(f)}}return t}function loadPatch(e,n){if(typeof e==="string"){if(/^@@/m.test(e)||/^Index:/m.test(e))return parsePatch(e)[0];if(!n)throw new Error("Must provide a base reference or pass in a patch");return structuredPatch(void 0,void 0,n,e)}return e}function fileNameChanged(e){return e.newFileName&&e.newFileName!==e.oldFileName}function selectField(e,n,r){if(n===r)return n;e.conflict=true;return{mine:n,theirs:r}}function hunkBefore(e,n){return e.oldStart<n.oldStart&&e.oldStart+e.oldLines<n.oldStart}function cloneHunk(e,n){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+n,newLines:e.newLines,lines:e.lines}}function mergeLines(e,n,r,t,i){var a={offset:n,lines:r,index:0},o={offset:t,lines:i,index:0};insertLeading(e,a,o);insertLeading(e,o,a);while(a.index<a.lines.length&&o.index<o.lines.length){var l=a.lines[a.index],s=o.lines[o.index];if(l[0]!=="-"&&l[0]!=="+"||s[0]!=="-"&&s[0]!=="+")if(l[0]==="+"&&s[0]===" "){var u;(u=e.lines).push.apply(u,_toConsumableArray(collectChange(a)))}else if(s[0]==="+"&&l[0]===" "){var f;(f=e.lines).push.apply(f,_toConsumableArray(collectChange(o)))}else if(l[0]==="-"&&s[0]===" ")removal(e,a,o);else if(s[0]==="-"&&l[0]===" ")removal(e,o,a,true);else if(l===s){e.lines.push(l);a.index++;o.index++}else conflict(e,collectChange(a),collectChange(o));else mutualChange(e,a,o)}insertTrailing(e,a);insertTrailing(e,o);calcLineCount(e)}function mutualChange(e,n,r){var t=collectChange(n),i=collectChange(r);if(allRemoves(t)&&allRemoves(i)){if(arrayStartsWith(t,i)&&skipRemoveSuperset(r,t,t.length-i.length)){var a;(a=e.lines).push.apply(a,_toConsumableArray(t));return}if(arrayStartsWith(i,t)&&skipRemoveSuperset(n,i,i.length-t.length)){var o;(o=e.lines).push.apply(o,_toConsumableArray(i));return}}else if(arrayEqual(t,i)){var l;(l=e.lines).push.apply(l,_toConsumableArray(t));return}conflict(e,t,i)}function removal(e,n,r,t){var i=collectChange(n),a=collectContext(r,i);if(a.merged){var o;(o=e.lines).push.apply(o,_toConsumableArray(a.merged))}else conflict(e,t?a:i,t?i:a)}function conflict(e,n,r){e.conflict=true;e.lines.push({conflict:true,mine:n,theirs:r})}function insertLeading(e,n,r){while(n.offset<r.offset&&n.index<n.lines.length){var t=n.lines[n.index++];e.lines.push(t);n.offset++}}function insertTrailing(e,n){while(n.index<n.lines.length){var r=n.lines[n.index++];e.lines.push(r)}}function collectChange(e){var n=[],r=e.lines[e.index][0];while(e.index<e.lines.length){var t=e.lines[e.index];r==="-"&&t[0]==="+"&&(r="+");if(r!==t[0])break;n.push(t);e.index++}return n}function collectContext(e,n){var r=[],t=[],i=0,a=false,o=false;while(i<n.length&&e.index<e.lines.length){var l=e.lines[e.index],s=n[i];if(s[0]==="+")break;a=a||l[0]!==" ";t.push(s);i++;if(l[0]==="+"){o=true;while(l[0]==="+"){r.push(l);l=e.lines[++e.index]}}if(s.substr(1)===l.substr(1)){r.push(l);e.index++}else o=true}(n[i]||"")[0]==="+"&&a&&(o=true);if(o)return r;while(i<n.length)t.push(n[i++]);return{merged:t,changes:r}}function allRemoves(e){return e.reduce((function(e,n){return e&&n[0]==="-"}),true)}function skipRemoveSuperset(e,n,r){for(var t=0;t<r;t++){var i=n[n.length-r+t].substr(1);if(e.lines[e.index+t]!==" "+i)return false}e.index+=r;return true}function calcOldNewLineCount(e){var n=0;var r=0;e.forEach((function(e){if(typeof e!=="string"){var t=calcOldNewLineCount(e.mine);var i=calcOldNewLineCount(e.theirs);n!==void 0&&(t.oldLines===i.oldLines?n+=t.oldLines:n=void 0);r!==void 0&&(t.newLines===i.newLines?r+=t.newLines:r=void 0)}else{r===void 0||e[0]!=="+"&&e[0]!==" "||r++;n===void 0||e[0]!=="-"&&e[0]!==" "||n++}}));return{oldLines:n,newLines:r}}function reversePatch(e){return Array.isArray(e)?e.map(reversePatch).reverse():_objectSpread2(_objectSpread2({},e),{},{oldFileName:e.newFileName,oldHeader:e.newHeader,newFileName:e.oldFileName,newHeader:e.oldHeader,hunks:e.hunks.map((function(e){return{oldLines:e.newLines,oldStart:e.newStart,newLines:e.oldLines,newStart:e.oldStart,lines:e.lines.map((function(e){return e.startsWith("-")?"+".concat(e.slice(1)):e.startsWith("+")?"-".concat(e.slice(1)):e}))}}))})}function convertChangesToDMP(e){var n,r,t=[];for(var i=0;i<e.length;i++){n=e[i];r=n.added?1:n.removed?-1:0;t.push([r,n.value])}return t}function convertChangesToXML(e){var n=[];for(var r=0;r<e.length;r++){var t=e[r];t.added?n.push("<ins>"):t.removed&&n.push("<del>");n.push(escapeHTML(t.value));t.added?n.push("</ins>"):t.removed&&n.push("</del>")}return n.join("")}function escapeHTML(e){var n=e;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");n=n.replace(/"/g,"&quot;");return n}export{Diff,applyPatch,applyPatches,canonicalize,convertChangesToDMP,convertChangesToXML,createPatch,createTwoFilesPatch,diffArrays,diffChars,diffCss,diffJson,diffLines,diffSentences,diffTrimmedLines,diffWords,diffWordsWithSpace,formatPatch,merge,parsePatch,reversePatch,structuredPatch};

